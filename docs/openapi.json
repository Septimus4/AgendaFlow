{
  "openapi": "3.1.0",
  "info": {
    "title": "AgendaFlow",
    "description": "RAG service for Paris event queries",
    "version": "0.1.0"
  },
  "paths": {
    "/ask": {
      "post": {
        "summary": "Ask",
        "description": "Answer event-related questions.\n\nArgs:\n    request: Ask request\n\nReturns:\n    Answer with events and metadata",
        "operationId": "ask_ask_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AskRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AskResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/rebuild": {
      "post": {
        "summary": "Rebuild",
        "description": "Rebuild the event index.\n\nArgs:\n    request: Rebuild request\n\nReturns:\n    Rebuild statistics",
        "operationId": "rebuild_rebuild_post",
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Authorization"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RebuildRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RebuildResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health",
        "description": "Health check endpoint.\n\nReturns:\n    Service health status",
        "operationId": "health_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/metrics": {
      "get": {
        "summary": "Metrics",
        "description": "Prometheus metrics endpoint.\n\nReturns:\n    Prometheus metrics",
        "operationId": "metrics_metrics_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "Root",
        "description": "Root endpoint.",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AskRequest": {
        "properties": {
          "question": {
            "type": "string",
            "title": "Question",
            "description": "User question about events",
            "examples": [
              "Que faire ce week-end ?",
              "Concerts de jazz gratuits"
            ]
          },
          "from_date": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "From Date",
            "description": "Start date filter (ISO format)",
            "examples": [
              "2025-12-01T00:00:00"
            ]
          },
          "to_date": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "To Date",
            "description": "End date filter (ISO format)",
            "examples": [
              "2025-12-31T23:59:59"
            ]
          },
          "category": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Category",
            "description": "Category filter",
            "examples": [
              "concert",
              "exposition"
            ]
          },
          "price": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Price",
            "description": "Price constraint (free, cheap)",
            "examples": [
              "free"
            ]
          },
          "arrondissement": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 20.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Arrondissement",
            "description": "Paris arrondissement (1-20)",
            "examples": [
              11
            ]
          },
          "language": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Language",
            "description": "Response language (fr, en)",
            "examples": [
              "fr"
            ]
          }
        },
        "type": "object",
        "required": [
          "question"
        ],
        "title": "AskRequest",
        "description": "Request model for /ask endpoint."
      },
      "AskResponse": {
        "properties": {
          "answer": {
            "type": "string",
            "title": "Answer",
            "description": "Generated answer text"
          },
          "events": {
            "items": {
              "$ref": "#/components/schemas/Event"
            },
            "type": "array",
            "title": "Events",
            "description": "List of relevant events"
          },
          "sources": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Sources",
            "description": "Source URLs"
          },
          "filters_applied": {
            "additionalProperties": true,
            "type": "object",
            "title": "Filters Applied",
            "description": "Applied filters"
          },
          "latency_ms": {
            "type": "integer",
            "title": "Latency Ms",
            "description": "Total latency in milliseconds"
          },
          "retrieval_ms": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Retrieval Ms",
            "description": "Retrieval latency in milliseconds"
          },
          "generation_ms": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Generation Ms",
            "description": "Generation latency in milliseconds"
          },
          "trace_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Trace Id",
            "description": "Trace ID for debugging"
          }
        },
        "type": "object",
        "required": [
          "answer",
          "latency_ms"
        ],
        "title": "AskResponse",
        "description": "Response model for /ask endpoint."
      },
      "Event": {
        "properties": {
          "title": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Title",
            "examples": [
              "Jazz \u00e0 la Villette"
            ]
          },
          "start_datetime": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Start Datetime",
            "examples": [
              "2025-09-04T20:00:00"
            ]
          },
          "venue_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Venue Name",
            "examples": [
              "Philharmonie de Paris"
            ]
          },
          "city": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "City",
            "examples": [
              "Paris"
            ]
          },
          "arrondissement": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Arrondissement",
            "examples": [
              "19e"
            ]
          },
          "price": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Price",
            "examples": [
              "30\u20ac"
            ]
          },
          "url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Url",
            "examples": [
              "https://openagenda.com/event/123"
            ]
          },
          "categories": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Categories",
            "examples": [
              [
                "Concert",
                "Jazz"
              ]
            ]
          }
        },
        "type": "object",
        "title": "Event",
        "description": "Event information in response."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "HealthResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status",
            "description": "Service status"
          },
          "index_loaded": {
            "type": "boolean",
            "title": "Index Loaded",
            "description": "Whether index is loaded"
          },
          "index_size": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Index Size",
            "description": "Number of documents in index"
          },
          "timestamp": {
            "type": "string",
            "title": "Timestamp",
            "description": "Current timestamp"
          }
        },
        "type": "object",
        "required": [
          "status",
          "index_loaded",
          "timestamp"
        ],
        "title": "HealthResponse",
        "description": "Response model for /health endpoint."
      },
      "RebuildRequest": {
        "properties": {
          "mode": {
            "type": "string",
            "title": "Mode",
            "description": "Rebuild mode: full or incremental",
            "default": "full"
          },
          "since": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Since",
            "description": "ISO timestamp for incremental update"
          }
        },
        "type": "object",
        "title": "RebuildRequest",
        "description": "Request model for /rebuild endpoint."
      },
      "RebuildResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status",
            "description": "Rebuild status"
          },
          "events_fetched": {
            "type": "integer",
            "title": "Events Fetched",
            "description": "Number of events fetched"
          },
          "events_indexed": {
            "type": "integer",
            "title": "Events Indexed",
            "description": "Number of events indexed"
          },
          "duration_seconds": {
            "type": "number",
            "title": "Duration Seconds",
            "description": "Rebuild duration in seconds"
          },
          "manifest_hash": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Manifest Hash",
            "description": "Index manifest hash"
          }
        },
        "type": "object",
        "required": [
          "status",
          "events_fetched",
          "events_indexed",
          "duration_seconds"
        ],
        "title": "RebuildResponse",
        "description": "Response model for /rebuild endpoint."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}